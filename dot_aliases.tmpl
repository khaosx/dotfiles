# dot_aliases.tmpl - Zsh Command Aliases
# Managed by Chezmoi
# Author: Kristopher Newman
#
# This file contains aliases and functions for common commands.
# DO NOT edit ~/.aliases directly - edit this template instead and run: chezmoi apply

# Homebrew (macOS only)
{{- if eq .chezmoi.os "darwin" }}
alias brewup='brew bundle; brew cleanup; brew doctor; brew bundle dump --force'
{{- end }}

# Ansible
alias makerole='ansible-galaxy init --init-path=$HOME/Projects/ansible.infrastructure/roles'

# Chezmoi quick reference
chezhelp() {
  cat <<'EOF'
chezmoi quick reference
  chezmoi status          # what changed locally
  chezmoi diff            # preview changes before apply
  chezmoi edit <file>     # edit a managed file
  chezmoi add <file>      # start managing a file
  chezmoi apply           # apply templates to $HOME
  chezmoi update          # pull latest dotfiles + apply
  chezmoi cd              # open source dir in a subshell
EOF
}
alias czh='chezhelp'

# SSH key management - removes old host keys and adds fresh ones
keyfix() {
  local host="${1:?Usage: keyfix <hostname>}"
  local ip=""

  # Resolve IP using dig (with fallback to dscacheutil on macOS)
  if (( $+commands[dig] )); then
    ip=$(dig +short "$host" | tail -n1)
  {{- if eq .chezmoi.os "darwin" }}
  elif (( $+commands[dscacheutil] )); then
    ip=$(dscacheutil -q host -a name "$host" | awk '/ip_address/ {print $2; exit}')
  {{- end }}
  else
    echo "Warning: Could not resolve IP (no supported resolver found)."
  fi

  # Remove old keys
  ssh-keygen -R "$host" &> /dev/null
  [[ -n "$ip" ]] && ssh-keygen -R "$ip" &> /dev/null

  # Add fresh keys
  ssh-keyscan -H "$host" >> ~/.ssh/known_hosts 2>/dev/null
  [[ -n "$ip" ]] && ssh-keyscan -H "$ip" >> ~/.ssh/known_hosts 2>/dev/null

  echo "Refreshed keys for $host${ip:+ ($ip)}"
}

# EOF
